# @flowscape-ui/canvas-react — идея проекта

Проект: Библиотека для работы с интерактивным бесконечным canvas и узлами (nodes), аналогичная по концепциям React Flow (XYFlow).

Ссылка на аналог: https://deepwiki.com/xyflow/xyflow/1-overview

Публикация: npm-пакет `@flowscape-ui/canvas-react`.

Установка:

- Bun: `bun add @flowscape-ui/canvas-react`
- npm: `npm install @flowscape-ui/canvas-react`

## Цели и принципы

- Производительная отрисовка и плавные взаимодействия даже при большом числе узлов.
- Единое UX для мыши и тачпада, предсказуемые модификаторы и комбинации клавиш.
- Независимые от зума размеры интерактивных хендлеров.
- Канвас, который автоматически скроллится при перетаскивании объекта к краям.

## Основной функционал (из todo)

### 1) Навигация по canvas

- Перемещение при зажатии колёсика мыши.
- Перемещение при зажатой ПКМ.
- Скролл вверх/вниз колесом.
- Shift + wheel — горизонтальный скролл (влево/вправо).
- Поддержка touchpad.

### 2) Зум canvas

- Диапазон зума: 10% — 500%.
- Ctrl + wheel — увеличение/уменьшение зума.
- Поддержка touchpad-жестов.

### 3) Создание Node

- Структура Node: `{ id, parentId, label, data, position, dimensions, selected }`.
  - position — координаты на canvas.
  - dimensions — ширина/высота.
  - data — произвольные пользовательские данные.
  - parentId — для иерархий/группировок.

### 4) Поведение Node

- DnD (перетаскивание), Select/DeSelect, Hover.
- Transform: поворот (rotation), изменение размеров (resize).
- Скругление углов.

### 5) Стилизация Node

- Возможность принимать HTML-подобные слоты/элементы (header, footer, main и т.п.), чтобы Node выглядел как HTML-блок.

### 6) Функционал canvas

- История действий (Undo/Redo: Ctrl+Z, Ctrl+Shift+Z).
- Helper lines (вспомогательные направляющие).
- Copy/Paste узлов.
- Ctrl+X — вырезать node и вставить в другом месте относительно центра экрана.
- Дублирование: при зажатом Alt при перетаскивании; Ctrl+D — дублировать на месте.
- Ctrl+H — показать линейки по X и Y.
- Бесконечные линии-гуиды по X и Y (по центру), отображаются только при активной линейке; удаление линии — выбрать линию и Del.
- Вставка картинки из буфера обмена как Node.
- Вставка текста по аналогии с картинкой.
- Прямоугольное выделение (рамкой) при зажатой ЛКМ.
- Группировка объектов и совместное перемещение (деревянная структура данных).
- Виджет статуса: текущий zoom и координаты canvas (x, y).
- Разные фоны canvas (темы/паттерны).
- Хендлеры независимы от зума: визуальный размер всегда статичен.
- Автопрокрутка поля при перетаскивании объекта к/за край canvas.

## Горячие клавиши и взаимодействия

- Навигация: колесо/ПКМ/Shift+wheel; touchpad-жесты.
- Зум: Ctrl+wheel; touchpad-жесты. Диапазон 10–500%.
- Выделение: клик/рамка; мультивыбор с модификаторами (проектно).
- Undo/Redo: Ctrl+Z / Ctrl+Shift+Z.
- Copy/Paste: Ctrl+C / Ctrl+V; Cut: Ctrl+X (вставка относительно центра экрана).
- Дублирование: Alt+перетаскивание; Ctrl+D — дубликат на месте.
- Линейки: Ctrl+H; удаление линии — Del по выбранной линии.

## Технические заметки

- Дерево узлов (parentId) для группировок и совместных трансформаций.
- Разделение координатных систем: экранная (screen), канвасная (world), учёт масштаба/скролла.
- Снаппинг к helper lines (прилипание) — проектно, за пределами MVP.
- Вставка из буфера обмена: обработка изображений и текста как разных типов Node.

## MVP (первая версия)

- Навигация + Зум с указанными комбинациями и тачпадом.
- Создание/удаление Node, базовая структура данных.
- Select/DnD, рамочное выделение, группировка и перемещение.
- Copy/Paste, Ctrl+X, Alt-duplicate, Ctrl+D.
- Undo/Redo.
- Helper lines + rulers (Ctrl+H) и удаление линий.
- Виджет (zoom, x, y) и независимые от зума хендлеры.

## Публикация и API (черновик)

- Пакет: `@flowscape-ui/canvas-react` (npm).
- Бандлы: ESM + TypeScript типы.
- Базовый импорт (проектно):
  ```ts
  import { Canvas, useCanvas, Node } from '@flowscape-ui/canvas-react';
  ```
- Стабильный публичный API будет зафиксирован после реализации MVP.
